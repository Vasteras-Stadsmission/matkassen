name: Continuous Deployment

on:
    push:
        branches: [main]

jobs:
    deploy-to-staging:
        uses: ./.github/workflows/deploy.yml
        with:
            environment: staging
        secrets:
            SERVER_HOST: ${{ secrets.SERVER_HOST_STAGING }}
            SERVER_USER: ${{ secrets.SERVER_USER }}
            SERVER_SSH_KEY: ${{ secrets.SERVER_SSH_KEY }}

    manual-deploy-to-production:
        needs: deploy-to-staging
        uses: ./.github/workflows/deploy.yml
        with:
            environment: production
        secrets:
            SERVER_HOST: ${{ secrets.SERVER_HOST_PRODUCTION }}
            SERVER_USER: ${{ secrets.SERVER_USER }}
            SERVER_SSH_KEY: ${{ secrets.SERVER_SSH_KEY }}
