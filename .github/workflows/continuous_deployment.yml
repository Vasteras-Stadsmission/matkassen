name: Continuous Deployment

on:
    push:
        branches: [main]

jobs:
    deploy-to-staging:
        uses: ./.github/workflows/deploy.yml
        with:
            environment: staging
        secrets:
            AUTH_GITHUB_ID: ${{ secrets.AUTH_GITHUB_ID }}
            AUTH_GITHUB_SECRET: ${{ secrets.AUTH_GITHUB_SECRET }}
            AUTH_SECRET: ${{ secrets.AUTH_SECRET }}
            EMAIL: ${{ secrets.EMAIL }}
            POSTGRES_DB: ${{ secrets.POSTGRES_DB }}
            POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}
            POSTGRES_USER: ${{ secrets.POSTGRES_USER }}
            SERVER_HOST: ${{ secrets.SERVER_HOST_STAGING }}
            SERVER_SSH_KEY: ${{ secrets.SERVER_SSH_KEY }}
            SERVER_USER: ${{ secrets.SERVER_USER }}

    manual-deploy-to-production:
        needs: deploy-to-staging
        uses: ./.github/workflows/deploy.yml
        with:
            environment: production
        secrets:
            AUTH_GITHUB_ID: ${{ secrets.AUTH_GITHUB_ID }}
            AUTH_GITHUB_SECRET: ${{ secrets.AUTH_GITHUB_SECRET }}
            AUTH_SECRET: ${{ secrets.AUTH_SECRET }}
            EMAIL: ${{ secrets.EMAIL }}
            POSTGRES_DB: ${{ secrets.POSTGRES_DB }}
            POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}
            POSTGRES_USER: ${{ secrets.POSTGRES_USER }}
            SERVER_HOST: ${{ secrets.SERVER_HOST_PRODUCTION }}
            SERVER_SSH_KEY: ${{ secrets.SERVER_SSH_KEY }}
            SERVER_USER: ${{ secrets.SERVER_USER }}
